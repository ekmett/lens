language: haskell

env:
  - >
    GHCVER=7.4.2
    mode="--enable-tests"
    script="cabal-1.18 test --show-details=always"
  - >
    GHCVER=7.6.3
    mode="--enable-tests"
    script="cabal-1.18 test --show-details=always"
  # - mode="--enable-tests -fsafe" script="cabal test"
  # - mode="--enable-tests -fdump-splices" script="cabal test --show-details=always"
  # - mode="--enable-benchmarks -fdump-splices" script="cabal bench"

before_install:
  # Uncomment whenever hackage is down.
  # - mkdir -p ~/.cabal && cp travis/config ~/.cabal/config && cabal update
  - cabal update

  # Try installing some of the build-deps with apt-get for speed.
  - travis/cabal-apt-install $mode
  
  # Install the GHC we want from hvr's PPA.
  - sudo add-apt-repository -y ppa:hvr/ghc
  - sudo apt-get update
  - sudo apt-get install cabal-install-1.18 ghc-$GHCVER
  - export PATH=/opt/ghc/$GHCVER/bin:$PATH

install:
  - cabal-1.18 update
  - cabal-1.18 configure -flib-Werror $mode

script:
  - cabal-1.18 build
  - $script
  - scripts/stats

notifications:
  irc:
    channels:
      - "irc.freenode.org#haskell-lens"
    skip_join: true
    template:
      - "\x0313lens\x03/\x0306%{branch}\x03 \x0314%{commit}\x03 %{build_url} %{message}"
